{% extends 'restaurant/base.html' %}
{% load static %}

{% block css %}
<link rel="stylesheet" type="text/css" href="{% static 'restaurant/css/easySelectStyle.css' %}" />
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
   integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
   crossorigin=""/>
{% endblock %}

{% block content %}
            <!-- right top menu -->
            <div class="it-ad-hl pd-tb-md">
              <div class="rb-pd-rl">
                <div class="it-ac-hd">
                  <div class="sc-hd">
                    <h1>Restaurant Details</h1>
                  </div>
                  <!-- <div class="ac-bt-hl">
                    <a href="{% url 'restaurant:restaurant-detail-edit' request.restaurant.id %}">
                        <button class="ac-bt">Edit</button>
                    </a>
                  </div> -->
                </div>
                <!-- heading -->
                <div class="ad-fd-fm pd-tb-md">
                  <form method="" action="." enctype="multipart/form-data">
                    {% csrf_token %}
                    <!-- form list full width-->
                    <div class="fm-ls sm-mb">
                      <div class="fm-ls-td js-sb">
                        <div class="fm-ls sm-mb">
                            <label>Restaurant Name</label>
                            {{ form.name }}
                        </div>
                      </div>
                    </div>
                    <!-- form list logo-button on image changed  -->
                    <div class="rest__logo sm-mb">
                      <div class="logo_pre">
                        {% if request.restaurant.logo %}
                            <img id="blah" src="{{ request.restaurant.logo.url }}" alt="Restaurant Image" />
                        {% else %}
                            <img id="blah" src="{% static 'restaurant/images/rest_logo.jpg' %}" alt="Restaurant Image" />
                        {% endif  %}
                      </div>
                    </div>
                    <div class="fm-ls sm-mb">
                        <div class="fm-ls-td">
                            <div class="pv-im-hl">
                            {% if request.restaurant.images.last %}
                                <img id="image_blah" src="{{ request.restaurant.images.last.image.url }}" alt="your image" />

                            {% else %}
                                <img id="image_blah" src="{% static 'restaurant/images/rest_logo.jpg' %}" alt="your image" />
                            {% endif  %}

                            </div>
                        </div>
                    </div>
                    <!-- form list half width changed-->
                    <div class="fm-ls sm-mb">
                        <label>Street</label>
                        {{ form.street }}
                    </div>
                    <!-- form list -->
                    <div class="fm-ls sm-mb">
                        <label>Town</label>
                        {{ form.town }}
                    </div>
                    <!-- form list -->
                    <div class="fm-ls sm-mb">
                        <label>State</label>
                        {{ form.state }}
                    </div>
                    <!-- form list -->
                    <div class="fm-ls sm-mb">
                        <label>Zip Code</label>
                        {{ form.zip_code }}
                    </div>
                    <div class="fm-ls sm-mb">
                        <label>Restaurant Contact Number</label>
                        {{ form.contact }}
                    </div>
                    <!-- form list -->
                    <div class="fm-ls sm-mb">
                        <label>Email Address</label>
                        {{ form.email }}
                    </div>
                    <!-- form list -->
                    <div class="fm-ls sm-mb">
                        <label>Restaurant Registration Number</label>
                        {{ form.registration_number }}
                    </div>
                    <!-- form list -->
                    <div class="fm-ls sm-mb">
                        <div class="fm-ls-td js-sb">
                            <div class="fm-hf-ls">
                                <label>Opening Time</label>
                                {{ form.opening_time }}
                            </div>
                            <div class="fm-hf-ls">
                                <label>Closing TIme</label>
                                {{ form.closing_time }}
                            </div>
                        </div>
                    </div>
                    <!-- form list -->
                    <div class="fm-ls sm-mb">
                        <div class="fm-ls-td js-sb">
                            <div class="fm-hf-ls">
                                <label>Delivery Time</label>
                                {{ form.delivery_time }}
                            </div>
                            <div class="fm-hf-ls">
                                <label>Delivery Charge</label>
                                {{ form.delivery_charge }}
                            </div>
                        </div>
                    </div>

                    {% if rest_cuisine %}
                    <div class="fm-ls sm-mb">
                        <label>Selected Cuisines</label>
                        <p>
                        {% for item in rest_cuisine.cuisine.all %}
                            {{ item.name }},
                        {% endfor %}
                        </p>

                    </div>
                    {% endif %}
                    {{ form.media }}
                    <div class="fm-ls sm-mb">
                        <div id="map" style="height: 500px; width: 100%; z-index: 0;"></div>
                    </div>
                    <input type="text" id="lat" name="lat" hidden value="{{ request.restaurant.latitude }}" />
                    <input type="text" id="lon" name="lon" hidden value="{{ request.restaurant.longitude }}" />
                    <!-- <div class="fm-ls sm-mb">
                      <button class="sb-bt mx-auto d-flex">
                        Restaurant Details
                      </button>
                    </div> -->
                  </form>
                </div>
              </div>
            </div>
          </div>
          <!-- right body part -->
        </div>
      </div>

{% endblock %}


{% block script %}
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>
  <script>
    if ('{{ request.restaurant.location_point }}' != 'None'){
        var points = [{{ request.restaurant.latitude }}, {{ request.restaurant.longitude }}];
    }
    else{
        var points = [42.730610, -73.935242];
    }
    map = L.map('map', {doubleClickZoom: false}).locate({setView: true, maxZoom: 15});

    var osm = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    var googleStreets = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}',{
    maxZoom: 20,
    subdomains:['mt0','mt1','mt2','mt3']
    });
    var googleHybrid = L.tileLayer('http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}',{
    maxZoom: 20,
    subdomains:['mt0','mt1','mt2','mt3']
    });
    var googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
    maxZoom: 20,
    subdomains:['mt0','mt1','mt2','mt3']
    });
    var googleTerrain = L.tileLayer('http://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}',{
    maxZoom: 20,
    subdomains:['mt0','mt1','mt2','mt3']
    });

    //for changing the layer(layer switcher)
    var baseLayers = {
        "OpenStreetMap": osm,
        "Google Streets": googleStreets,
        "Google Hybrid": googleHybrid,
        "Google Satellite": googleSat,
        "Google Terrain": googleTerrain,
    };

    map.addLayer(googleStreets);
    var layerswitcher = L.control.layers(baseLayers, {}, {collapsed: true}).addTo(map);
    var icons=L.icon({
        iconSize: [44, 45],
        iconAnchor: [10, 22],
        popupAnchor:  [2, -24],
        shadowAnchor: [2, 18],

        iconUrl:"{% static 'images/marker.png' %}",
        shadowUrl: 'https://unpkg.com/leaflet@1.0.3/dist/images/marker-shadow.png'
    });
    var marker = L.marker(points,{icon:icons}).addTo(map);


    map.on('click',function(e){
        lat = e.latlng.lat;
        lon = e.latlng.lng;

        //Clear existing marker,
        if (marker != undefined) {
            map.removeLayer(marker);
            console.log(lat);
            console.log('clicked')
            $('#lat').val(lat);
            $("#lon").val(lon);
        };

        //Add a marker to show where you clicked.
        marker = L.marker([lat,lon], {icon:icons}).addTo(map);
    });
  </script>
{% endblock %}
